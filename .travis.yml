language: generic
os:
  - linux
dist: bionic
cache:
  directories:
    - "$HOME/.ivy2/cache"
    - "$HOME/.sbt/boot"
    - "$HOME/.sbt/launchers"
services:
  - docker
before_install:
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - echo "$REGISTRY_PASSWORD" | docker login -u "$REGISTRY_USER" --password-stdin
install:
  - docker-compose pull scala-text-pdf-compile
  - docker-compose build
script:
  - docker-compose up --abort-on-container-exit
before_cache:
  - find $HOME/.sbt -name "*.lock" | sudo xargs rm
  - find $HOME/.ivy2 -name "ivydata-*.properties" | sudo xargs rm
  - find $HOME/.ivy2/cache -name "*SNAPSHOT*" | sudo xargs rm -rf
after_success:
  - ./travis/deploy_image.sh
  - ./travis/deploy_pdf.sh
after_failure:
  - cat scala_text.log
env:
  global:
    - IMAGE_NAME=yyupw/scala-text-pdf
    - REGISTRY_USER=yyupw
    - DOCKER_COMPOSE_VERSION=1.24.1
    - secure: Ip/i6NRVax9vGnCBylXtSTsAI6fabSiSLwg0TUOxSR6YAZCZ3MECfC+FM1Q+0ReT6w/UYpyLuJgIaDFs2pQJm7bwmksk0e8G7i86WnRBp9vAFdXBr7VjB2939JhG6AR3Wbu6bNBY3yqd+x10k8UhoPSMiphJodWiuLIAYPbZTYXIuKB+5MUaLvUmtc/1MPWV54rtQyM7ACK9p2pf9HiX0zgSYb2QM91DIbvd8G1Rcglny2fwsNk5wR6pGIwJDD71XNQ2hx1crQGLe48n+rJoV8DqAqnjkLOZsPojqd5k0bF8ZWwZgFwKMRgT+nGfYl06rf9gzXqGHNcDbXnNG63YCcJwSOEetKXtGfOdf8Ho1w8nvni4qQY7R/tx5yg0+b8jGzyKn3CfoklS3p0gwMDNQfTPg6JvmpjGZEy3CD97HZ+9ZwVQMZrwMw4O2x6oGnVaIyHOyj3GGB1d4F+XTqZBwi1KygiGjyqczHkrrb178B1lquIVt3xb37/LClZi9V/1ZxMgxzsw6exOpjOOVDBsKvt3qba5JFN6GtYmloSlYMv6M1/8QuFDRqYXGaXJMNdth8V4xHWwi5b37r8pL+/kr5etRB4JUthJybZKzZutuxdFgOhiNJE5QsDgL1Fe4dUaNhbN9n/E+9SBK86agFXd7wrqPxCcPJzY4zNWFMxc5+8=
    - secure: AFy4f34KH0WN4B6+3h+R9hH1pNfGm6dAbvZV6Vs1yXTWG2o2/13FrDHQvzll9Q8LxqdOtFGFA7EnEbthT8/TYKGl0ygBzUADUIiDKQmXJWDVkxTsZy8GoXXdj28jFZkhFnqKbTQdfJk88iMFKAaBndeGKPqbw674AqHrFIJZ0KBZ7klrfrOYXRByUPKvIc/2UTmurUipUZPuyOufY8ew9/Kgj9G8GgHObijvjoZepjZDdT8XEVNqMRV2/QR2j4XaYbF8lQ0F0jKRbEdABFwZJsMq05l3gD+GbCr9va/AjSQzKNfdK706OOtpRdr535IP0WXtceskVMQc5J8DFl7OAZjbp4i8AERdZCRCfJ/ikRwGXhfNDQvBkC0e7s0Ixf4kjusZilQpWaBU1KJwDeZr6tPB78DRJ+zTjgaYFXUxKBHKW2jFAoUKY6NacRM6csIvlFKN+uRH5fLirY66UvrlJqAeiK5u4AQXszgkpN5e9i8LGMEZrTscj+Lf8fLQZW6d9vEfWZbLMn3VNav1TjS5WJ1NCwMK2h4Dw8EHN6EE7EOe9DvgvpKZh0ZmEIawa95cpivT5dHzORRaDtRdHcltZ8Ff+j/AqCb/X8iTQq5T8ozsFahSAtYv0/1cA9eGIe2tjU5Ht1rYMcecWz3L4+we9mwj9GsPecy66OYOfYQQssI=
