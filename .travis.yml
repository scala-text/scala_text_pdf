language: generic
os:
  - linux
dist: bionic
sudo: required
cache:
  directories:
    - "$HOME/.ivy2/cache"
    - "$HOME/.sbt/boot"
    - "$HOME/.sbt/launchers"
services:
  - docker
before_install:
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
install:
  - docker-compose pull
  - docker-compose build
script:
  - docker-compose up --exit-code-from scala-text-pdf-compile
before_cache:
  - find $HOME/.sbt -name "*.lock" | sudo xargs rm
  - find $HOME/.ivy2 -name "ivydata-*.properties" | sudo xargs rm
  - find $HOME/.ivy2/cache -name "*SNAPSHOT*" | sudo xargs rm -rf
after_success:
  - ./travis/deploy_image.sh
  - ./travis/deploy_pdf.sh
after_failure:
  - cat scala_text.log
env:
  global:
    - IMAGE_NAME=yyupw/scala-text-pdf
    - REGISTRY_USER=yyupw
    - DOCKER_COMPOSE_VERSION=1.24.1
    - secure: QmGM9q7sXJ9kA/NFz1AysL28tEHByyDYKJfYP4DT2Z418rDjqDtm93Ye8Fna3GHfkkC5689PNYzx8+ijpgh0D4y58OqSrSmBphhwiqOITFUsxhBE8d+k9eYUfVlHEWW6pGWRxRmqbY+7E5DMWxPiJ0+yMJxLkGzkrXCmuAHpUCrIctDidoULSUOumHvqSYz9S8CfK6sKewrvhUhoJbU0hc/3x2NzqCegZLYTUrjYFU2+ctVFZ0mb+U4toXg776vZJjIokYgqQjHmcv9uBE9kcDUmZHin486g8KBmuYQAesyhBDFDWalk5H9EVNkN53umXe6LZn8xZj2QDEamrBltW/o1ZJjaW+W7evbW21tdf22cCDLcx8IeHZrIVETT6aAdioUtR1w6RLJsRb9OOHoJnZM56C2kiO7GvaeLmXsQO35jayf4ydg06cAmdu7zYAoz3hLkfnKLwnQkot8Yc+JeHWjqEmMfLLjWzReBt596AVFhUYxtVNuSKYqGzNuz8f6wWh8L+TxzjFsTrAO5p7VcnhIt2A2S3yyQh0CRr3AZi4lY+RAJUKuWXGtg2zQU8o5SXhSIzcTeAnDu7w28f0u+CL1Nj0m4imjmgPX26tumSyGlojsHaWF5xgFobPeDOwX+odd9QHBJKuoS5LuAtDiVQc6rnlCDGpolRJrm6dWAL7I=
    - secure: AFy4f34KH0WN4B6+3h+R9hH1pNfGm6dAbvZV6Vs1yXTWG2o2/13FrDHQvzll9Q8LxqdOtFGFA7EnEbthT8/TYKGl0ygBzUADUIiDKQmXJWDVkxTsZy8GoXXdj28jFZkhFnqKbTQdfJk88iMFKAaBndeGKPqbw674AqHrFIJZ0KBZ7klrfrOYXRByUPKvIc/2UTmurUipUZPuyOufY8ew9/Kgj9G8GgHObijvjoZepjZDdT8XEVNqMRV2/QR2j4XaYbF8lQ0F0jKRbEdABFwZJsMq05l3gD+GbCr9va/AjSQzKNfdK706OOtpRdr535IP0WXtceskVMQc5J8DFl7OAZjbp4i8AERdZCRCfJ/ikRwGXhfNDQvBkC0e7s0Ixf4kjusZilQpWaBU1KJwDeZr6tPB78DRJ+zTjgaYFXUxKBHKW2jFAoUKY6NacRM6csIvlFKN+uRH5fLirY66UvrlJqAeiK5u4AQXszgkpN5e9i8LGMEZrTscj+Lf8fLQZW6d9vEfWZbLMn3VNav1TjS5WJ1NCwMK2h4Dw8EHN6EE7EOe9DvgvpKZh0ZmEIawa95cpivT5dHzORRaDtRdHcltZ8Ff+j/AqCb/X8iTQq5T8ozsFahSAtYv0/1cA9eGIe2tjU5Ht1rYMcecWz3L4+we9mwj9GsPecy66OYOfYQQssI=
